<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DM6 Elm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- silence 404 favicon -->
    <link rel="icon" href="data:,">
    <style>
      html, body { height: 100%; margin: 0; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
             user-select: none; -webkit-user-select: none; }
    </style>
  </head>
  <body>
    <noscript>This app requires JavaScript.</noscript>

    <!-- 1) load bundle -->
    <script src="main.js"></script>

    <!-- 2) init AFTER window 'load' -->
    <script>
      (function () {
        function init() {
          if (!window.Elm) {
            console.error('Elm bundle not loaded. window.Elm =', window.Elm);
            return;
          }
          var Boot = (Elm.AppMain || Elm.Main);
          if (!Boot) {
            console.error('No Elm root found. Keys:', Object.keys(Elm));
            return;
          }

          var flags = null;
          try {
            var raw = localStorage.getItem('dm6-elm');
            flags = raw ? JSON.parse(raw) : null;
          } catch (_) {}

          try {
            window.app = Boot.init({ flags: flags });
          } catch (e) {
            try { window.app = Boot.init(); }
            catch (e2) { console.error('Failed to init Elm app', e2); }
          }
          // optional legacy alias
          window._dm6 = window.app;
        }

        if (document.readyState === 'complete') init();
        else window.addEventListener('load', init);
      })();
    </script>
    <script>
      // Dev-only: make the Elm debugger overlay always visible and on top.
      if (location.hostname === 'localhost') {
        (function ensureElmDebuggerOnTop() {
          function promote() {
            var ov = document.querySelector('.elm-overlay');
            if (!ov) return;
            // Move overlay to <body> to escape transformed/overflow parents
            if (ov.parentNode !== document.body) {
              document.body.appendChild(ov);
            }
            // Force on-top & clickable
            ov.style.position = 'fixed';
            ov.style.zIndex = '2147483647';
            ov.style.pointerEvents = 'auto';
            // Avoid accidental clipping
            ov.style.inset = 'auto'; // keep default positions
          }

          // Try now and on future DOM changes (Elm hot reload, route changes, etc.)
          var mo = new MutationObserver(promote);
          mo.observe(document.documentElement, { childList: true, subtree: true });
          // Also re-run after load
          if (document.readyState === 'complete') promote();
          else window.addEventListener('load', promote);
        })();
      }
    </script>
  </body>
</html>
